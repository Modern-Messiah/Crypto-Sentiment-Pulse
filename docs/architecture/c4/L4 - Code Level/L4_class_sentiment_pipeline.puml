@startuml L4_class_sentiment_pipeline
skinparam class {
    BackgroundColor #438dd5
    FontColor #ffffff
    BorderColor #3c7fc0
    ArrowColor #666666
}
skinparam note {
    BackgroundColor #f5f5f5
    BorderColor #cccccc
    FontColor #333333
}
skinparam FontName SansSerif

title Class Diagram — Market Sentiment Pipeline (L4)

class "Alternative.me API" <<external>> {
    + GET /fng/?limit=1
    --
    Returns: value, classification,\ntimestamp
}

class FearGreedService <<fear_greed.py>> {
    + get_fear_greed_index(): dict
    --
    Uses: httpx async client
    Returns: {value, classification,\ntimestamp}
}

class BinanceUpdaterMixin <<updater.py>> {
    + _fear_greed_update_loop(redis_client)
    --
    Interval: every 5 minutes\n(asyncio loop)
}

class Redis <<database>> {
    + SET crypto:fear_greed (JSON)
    + GET crypto:fear_greed (JSON)
}

class SentimentRouter <<sentiment.py>> {
    + read_fear_greed(): dict
    --
    Route: GET /api/v1/sentiment/fear-greed
    Fallback: value=50 (Neutral)\nif key missing in Redis
}

' Correct dependency direction: caller ..> callee
FearGreedService     ..>  "Alternative.me API" : "HTTPS GET /fng/"
BinanceUpdaterMixin  ..>  FearGreedService     : "calls every 5 min"
BinanceUpdaterMixin  ..>  Redis                : "SET crypto:fear_greed"
SentimentRouter      ..>  Redis                : "GET crypto:fear_greed"

note right of FearGreedService
  <b>Current Implementation:</b>
  Sentiment is aggregated at market level
  via Fear & Greed Index API.
  No local ML model present
  in the current version.
end note

note bottom of SentimentRouter
  <b>Fallback:</b>
  If Redis key missing —
  returns default Neutral (50)
  to avoid 500 on cold start.
end note

@enduml